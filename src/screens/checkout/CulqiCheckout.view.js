import {StyleSheet, View} from 'react-native';
import {WebView} from 'react-native-webview';

const CheckoutScreen = ({route, navigation}) => {
  const jsCode = `window.culqijs=function(w){var u={};function d(n){if(u[n])return u[n].exports;var l=u[n]={i:n,l:!1,exports:{}};return w[n].call(l.exports,l,l.exports,d),l.l=!0,l.exports}return d.m=w,d.c=u,d.d=function(n,l,p){d.o(n,l)||Object.defineProperty(n,l,{enumerable:!0,get:p})},d.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},d.t=function(n,l){if(1&l&&(n=d(n)),8&l||4&l&&typeof n=="object"&&n&&n.__esModule)return n;var p=Object.create(null);if(d.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:n}),2&l&&typeof n!="string")for(var s in n)d.d(p,s,function(m){return n[m]}.bind(null,s));return p},d.n=function(n){var l=n&&n.__esModule?function(){return n.default}:function(){return n};return d.d(l,"a",l),l},d.o=function(n,l){return Object.prototype.hasOwnProperty.call(n,l)},d.p="",d(d.s=0)}([function(w,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),Object.defineProperty(u,"Checkout",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(u,"Elements",{enumerable:!0,get:function(){return l.default}});var n=p(d(1)),l=p(d(2));function p(s){return s&&s.__esModule?s:{default:s}}},function(w,u,d){"use strict";function n(t,c){for(var f=0;f<c.length;f++){var o=c[f];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var l,p,s,m,x,b=!1,a={title:"Culqi Store",currency:"PEN",description:"Polo/remera Culqi lover",amount:100,version:3},r={lang:"auto",modal:!0,onlyInputs:!1,head:!0,installments:!1,customButton:"",style:{bgcolor:"#fafafa",maincolor:"#0ec1c1",disabledcolor:"#ffffff",buttontext:"#ffffff",maintext:"#4A4A4A",desctext:"#4A4A4A",logo:"https://static.culqi.com/v2/v2/static/img/logo.png"}},v="",i="",y=function(){function t(){(function(e,k){if(!(e instanceof k))throw new TypeError("Cannot call a class as a function")})(this,t)}var c,f,o;return c=t,(f=[{key:"_cambiarContenedor",value:function(){return v==""?"document.body":v}},{key:"init",value:function(){console.log("%cCULQI JS%cv3","padding: 5px; border-radius: 4px 0 0 4px; background: linear-gradient(#34c4ad, #0AA6A9); color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif;font-weight: bold;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)","padding: 5px; border-radius: 0 4px 4px 0; background-color: #676767; color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif")}},{key:"initCheckout",value:function(e){h(e)}},{key:"settings",value:function(e){var k=!0;return i.length>5?(a=e,Number(a.amount)%1==0?(a.amount=Number(a.amount),window.addEventListener("message",q,!1),this.initCheckout(!0),k=!0):console.log("%cJS%cEl monto no es v\xE1lido","padding: 5px; border-radius: 4px 0 0 4px; background-color: #38d9a9; color: #222b31; text-transform: uppercase; font-weight: bold; font-size: 10px;font-family: sans-serif","padding: 5px; border-radius: 0 4px 4px 0; background-color: #ad1411; color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif; font-weight: bold; text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)")):(b||console.log("%cJS%cNo configuro publicKey","padding: 5px; border-radius: 4px 0 0 4px; background-color: #38d9a9; color: #222b31; text-transform: uppercase; font-weight: bold; font-size: 10px;font-family: sans-serif","padding: 5px; border-radius: 0 4px 4px 0; background-color: #ad1411; color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif; font-weight: bold; text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)"),k=!1),k}},{key:"options",value:function(e){return e!==void 0&&(e.lang!==void 0&&(r.lang=e.lang),e.modal!==void 0&&(r.modal=e.modal),e.onlyInputs!==void 0&&(r.onlyInputs=e.onlyInputs),e.head!==void 0&&(r.head=e.head),e.installments!==void 0&&e.installments!=""&&(r.installments=e.installments),e.customButton!==void 0&&(r.customButton=e.customButton),e.style!==void 0&&(e.style.bgcolor!==void 0&&(r.style.bgcolor=e.style.bgcolor),e.style.maincolor!==void 0&&(r.style.maincolor=e.style.maincolor),e.style.disabledcolor!==void 0&&(r.style.disabledcolor=e.style.disabledcolor),e.style.buttontext!==void 0&&(r.style.buttontext=e.style.buttontext),e.style.maintext!==void 0&&(r.style.maintext=e.style.maintext),e.style.desctext!==void 0&&(r.style.desctext=e.style.desctext),e.style.logo!==void 0&&(r.style.logo=e.style.logo))),r}},{key:"open",value:function(){C()}},{key:"close",value:function(){h(!0)}},{key:"createToken",value:function(){var e,k,_,E,S,A=i.includes("pk_live_")?"live":i.includes("pk_test_")?"test":null;e=document.getElementsByClassName("culqi-email").length>0?document.getElementsByClassName("culqi-email")[0]:document.querySelectorAll('[data-culqi="card[email]"]').length>0?document.querySelectorAll('[data-culqi="card[email]"]')[0]:document.getElementById("card[email]"),k=document.getElementsByClassName("culqi-card").length>0?document.getElementsByClassName("culqi-card")[0]:document.querySelectorAll('[data-culqi="card[number]"]').length>0?document.querySelectorAll('[data-culqi="card[number]"]')[0]:document.getElementById("card[number]"),_=document.getElementsByClassName("culqi-cvv").length>0?document.getElementsByClassName("culqi-cvv")[0]:document.querySelectorAll('[data-culqi="card[cvv]"]').length>0?document.querySelectorAll('[data-culqi="card[cvv]"]')[0]:document.getElementById("card[cvv]"),E=document.getElementsByClassName("culqi-expy").length>0?document.getElementsByClassName("culqi-expy")[0]:document.querySelectorAll('[data-culqi="card[exp_year]"]').length>0?document.querySelectorAll('[data-culqi="card[exp_year]"]')[0]:document.getElementById("card[exp_year]"),S=document.getElementsByClassName("culqi-expm").length>0?document.getElementsByClassName("culqi-expm")[0]:document.querySelectorAll('[data-culqi="card[exp_month]"]').length>0?document.querySelectorAll('[data-culqi="card[exp_month]"]')[0]:document.getElementById("card[exp_month]");var I={email:e.value,card_number:k.value.replace(/\s/g,""),cvv:_.value,expiration_year:E.value,expiration_month:S.value},F=JSON.stringify(I),g=new XMLHttpRequest;g.open("POST","https://secure.culqi.com/tokens",!0),g.setRequestHeader("Content-type","application/json"),g.setRequestHeader("Authorization","Bearer "+i),g.setRequestHeader("X-API-VERSION","2"),g.setRequestHeader("X-API-KEY",i),g.setRequestHeader("X-CULQI-ENV",A),g.setRequestHeader("X-CULQI-CLIENT","culqiJS_v3"),g.setRequestHeader("X-CULQI-PRODUCT","online"),g.setRequestHeader("X-CULQI-SPONSOR",""),g.setRequestHeader("X-CULQI-SPONSOR-VERSION",""),g.onreadystatechange=function(){return g.status==200||g.status==201?(g.readyState==4&&(s=JSON.parse(g.response),culqi()),!1):(g.readyState==4&&(m=JSON.parse(g.response),culqi()),!1)},g.send(F)}},{key:"env",set:function(e){b=e}},{key:"name",get:function(){return"Culqi Checkout v3.0"}},{key:"publicKey",get:function(){return i},set:function(e){i=e}},{key:"container",get:function(){return v},set:function(e){v=e}},{key:"getSettings",get:function(){return a}},{key:"getOptions",get:function(){return r}},{key:"order",get:function(){return l}},{key:"token",get:function(){return s},set:function(e){s=e}},{key:"error",get:function(){return m}},{key:"closeEvent",get:function(){return x}}])&&n(c.prototype,f),o&&n(c,o),t}();function C(){var t;navigator.vendor=="Apple Computer, Inc."&&altScrollTo.call(window,0,0),document.querySelector(".culqi_checkout")!=null&&((t=document.getElementById("culqi_checkout_frame")).style.visibility="visible",t.style.display="block",t.style.width="100%",t.style.height="100%")}function h(t,c){var f,o=null,e=null,k="?public_key="+i+"&title="+encodeURIComponent(window.btoa(unescape(encodeURIComponent(a.title))))+"&currency="+encodeURIComponent(window.btoa(unescape(encodeURIComponent(a.currency))))+"&description="+encodeURIComponent(window.btoa(unescape(encodeURIComponent(a.description))))+"&amount="+encodeURIComponent(window.btoa(unescape(encodeURIComponent(a.amount))))+"&logo="+encodeURIComponent(window.btoa(unescape(encodeURIComponent(r.style.logo))))+"&installments="+r.installments+"&monto="+(isNaN(a.amount)?!1:a.amount>0)+"&version=3&culqi_js_version=v3 ";if(a.order!==void 0?k+="&orders="+encodeURIComponent(window.btoa(unescape(encodeURIComponent(a.order)))):k+="&orders=",document.querySelector(".culqi_checkout")==null){(o=document.createElement("IFRAME")).setAttribute("src","https://checkout.culqi.com"+k),o.setAttribute("id","culqi_checkout_frame"),o.setAttribute("name","checkout_frame"),o.setAttribute("class","culqi_checkout"),o.setAttribute("allowtransparency","true"),o.setAttribute("frameborder","0"),o.style.backgroundColor="rgba(0,0,0,0.62)",o.style.border="0px none trasparent",o.style.overflowX="hidden",o.style.overflowY="auto",o.style.margin="0px",r.modal?(o.style.zIndex=99999,o.style.position="fixed",o.style.visibility="hidden",o.style.visibility="collapse",o.style.height=0,o.style.width=0):(o.setAttribute("frameborder",0),o.setAttribute("allowfullscreen",!0),o.style.height="100%",o.style.width="100%"),o.style.left="0px",o.style.top="0px",o.style.backgroundPosition="initial initial",o.style.backgroundRepeat="initial initial",f=v!=""?document.getElementById(v):document.body;try{f.appendChild(o)}catch(_){console.log("%c>JS> Error: No existe contenedor %c"+f+"%c"+_,"padding: 0 10px; background-color: #000000; color: #ff0000; text-transform: uppercase; font-weight: bold;","background-color: #000000; padding: 0 10px; color: #fff","padding: 0 10px; color: #ff0000; font-weight: bold;")}navigator.vendor=="Apple Computer, Inc."&&(window.altScrollTo=o.contentWindow.scrollTo),(e=document.getElementById("culqi_checkout_frame")).addEventListener("load",function(){(function(_){_===!0&&console.log("%cCULQI Checkout%cv3.0","padding: 5px; border-radius: 4px 0 0 4px; background: linear-gradient(#34c4ad, #0AA6A9); color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif;font-weight: bold;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)","padding: 5px; border-radius: 0 4px 4px 0; background-color: #676767; color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif")})(t),function(){var _=y,E={_publicKey:i,_settings:a,_options:r},S=document.getElementById("culqi_checkout_frame");S?S.contentWindow.postMessage(E,"*"):console.log("%c>JS> Error: Revise contenedor %c"+_.container,"padding: 0 10px; background-color: #000000; color: #ff0000; text-transform: uppercase; font-weight: bold;","background-color: #000000; padding: 0 10px 0 0; color: #fff")}(),t||c===void 0||(e.contentWindow.postMessage({type:"recupera",data:c,order:p},"*"),C())})}else(e=document.getElementById("culqi_checkout_frame"))!=null&&(e.parentNode.removeChild(e),h(!1,c));return!0}function q(t){var c,f;if(x=null,typeof t.data=="string")try{c=JSON.parse(t.data)}catch{switch(t.data){case"culqi_destroy_checkout":setTimeout(function(){document.getElementById("culqi_checkout_frame").remove()},500);break;case"checkout_cerrado":x=t.data,s=null,(f=document.getElementById("culqi_checkout_frame"))!=null&&(f.style.visibility="hidden",f.style.visibility="collapse",f.style.width="0px",f.style.height="0px");break;case"checkout_cargando_recupera":x=t.data,s=null,culqi();break;default:t.data!=""&&console.log("%cJS%cNo se reconoce Instrucci\xF3n%c"+t.data,"padding: 5px; border-radius: 4px 0 0 4px; background-color: #38d9a9; color: #222b31; text-transform: uppercase; font-size: 10px;font-family: sans-serif","padding: 5px; background-color: #222b31; color: #ff8f00; text-transform: uppercase; font-size: 10px;font-family: sans-serif;border-left: 5px solid #ff8f00;","padding: 5px; border-radius: 0 4px 4px 0; background-color: #08696b; color: #fff; text-transform: uppercase; font-size: 10px;font-family: sans-serif; font-weight: bold;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)")}}else if(typeof t.data.object=="string")switch(t.data.object){case"error":var o=t.data.type?t.data.type.replace(/_/g," "):"Error",e=t.data.param?t.data.param:"",k=t.data.merchant_message?t.data.merchant_message:"",_=t.data.user_message?t.data.user_message:"";console.log("%cJS%c"+o+"%c"+e+"%c"+k+": "+_,"padding: 5px; border-radius: 4px 0 0 4px; background-color: #38d9a9; color: #222b31; text-transform: uppercase; font-size: 10px;font-family: sans-serif","padding: 5px; background-color: #222b31; color: #ff4f4f; text-transform: uppercase; font-size: 10px;font-family: sans-serif;border-left: 5px solid #ff4f4f;","padding: 5px; border-radius: 0 4px 4px 0; background-color: #08696b; color: #fff; text-transform: uppercase; font-size: 10px;font-family: sans-serif; font-weight: bold;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)","color: #FFF; font-family: sans-serif");var E=function(){var S=navigator.userAgent.toLowerCase();return S.indexOf("msie")!=-1&&parseInt(S.split("msie")[1])};c=E()&&E()<9?JSON.parse(t.data):t.data,s=null,m=c,p=null,o=null,a.version!="2"&&culqi(),a.order&&h(!0);break;case"order":o=t.data,m=null,s=null,culqi();break;case"token":console.log("%cJS%c"+t.data.object+"%c"+t.data.id,"padding: 5px; border-radius: 4px 0 0 4px; background-color: #38d9a9; color: #222b31; text-transform: uppercase; font-size: 10px;font-family: sans-serif","padding: 5px; background-color: #222b31; color: #ff8f00; text-transform: uppercase; font-size: 10px;font-family: sans-serif;border-left: 5px solid #ff8f00;","padding: 5px; border-radius: 0 4px 4px 0; background-color: #08696b; color: #fff; text-transform: uppercase; font-size: 10px;font-family: sans-serif; font-weight: bold;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)"),s=t.data,m=null,p=Object.assign({},o),o=null,culqi()}}u.default=y,w.exports=u.default},function(w,u,d){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var n,l=(n=d(3))&&n.__esModule?n:{default:n};function p(i){return(p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(i)}function s(i,y){for(var C=0;C<y.length;C++){var h=y[C];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}var m,x,b="",a="https://checkout.culqi.com/#/elements",r=a+"/controller/",v=function(){function i(q){(function(t,c){if(!(t instanceof c))throw new TypeError("Cannot call a class as a function")})(this,i),this.iframe=document.createElement("IFRAME"),this.elementStatus="init",q?(b=q,console.log("%cCULQI Elements%c","padding: 5px; border-radius: 4px 0 0 4px; background: linear-gradient(#34c4ad, #0AA6A9); color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif;font-weight: bold;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)","padding: 5px; border-radius: 0 4px 4px 0; background-color: #676767; color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif",q)):console.log("%cJS%cNo configuro publicKey","padding: 5px; border-radius: 4px 0 0 4px; background-color: #38d9a9; color: #222b31; text-transform: uppercase; font-weight: bold; font-size: 10px;font-family: sans-serif","padding: 5px; border-radius: 0 4px 4px 0; background-color: #ad1411; color: #FFF; text-transform: uppercase; font-size: 10px;font-family: sans-serif; font-weight: bold; text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.3)"),document.querySelector("#elements_frame_controller")==null&&(this.iframe.setAttribute("src",r),this.iframe.setAttribute("class","culqi-elements_controller"),this.iframe.setAttribute("id","elements_frame_controller"),this.iframe.setAttribute("name","elements_frame_controller"),this.iframe.setAttribute("allowtransparency","true"),this.iframe.setAttribute("frameborder","0"),this.iframe.style.height="0px",this.iframe.style.width="0px",document.body.appendChild(this.iframe)),window.addEventListener("message",function(t){var c=t.data;if(m=null,x=null,c.type==="clq-element_autofocus"){var f="";switch(c.element){case"expiry":f="Expiry";break;case"cvv":f="Cvc"}document.querySelector(".culqi-element_iframe[name = culqi-element_card"+f).contentWindow.postMessage({type:"clq_focusElement"},a)}c.type=="clq-element_event"&&(document.querySelectorAll(".culqi-element_iframe"),document.querySelector('.culqi-element_iframe[name="culqi-element_cardCvc"]').contentWindow.postMessage({data:c.data,type:"clq_setCVVMask"},a)),c.object=="token"?(m=c,culqi()):c.object=="error"&&(x=c,culqi())},!1)}var y,C,h;return y=i,(C=[{key:"create",value:function(q,t){return t===void 0&&(t=0),new l.default(q,t)}},{key:"sendData",value:function(q){var t,c=document.querySelector("#elements_frame_controller"),f=document.querySelectorAll(".culqi-element_iframe");c.contentWindow.postMessage({type:"clq_restartElementsData"},r);for(var o=0;o<f.length;o++)f[o].contentWindow.postMessage({type:"clq_getElementsData"},a),t=p(q)=="object"?{type:"clq_getElementsData",metadata:q}:{type:"clq_getElementsData"},c.contentWindow.postMessage(t,r)}},{key:"publicKey",get:function(){return b},set:function(q){b=q}},{key:"token",get:function(){return m}},{key:"error",get:function(){return x}}])&&s(y.prototype,C),h&&s(y,h),i}();u.default=v,w.exports=u.default},function(w,u,d){"use strict";function n(s,m){for(var x=0;x<m.length;x++){var b=m[x];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(s,b.key,b)}}Object.defineProperty(u,"__esModule",{value:!0}),u.default=void 0;var l="https://checkout.culqi.com/#/elements",p=function(){function s(a,r){(function(v,i){if(!(v instanceof i))throw new TypeError("Cannot call a class as a function")})(this,s),this.type=a,this.options=r,this.iframe=document.createElement("IFRAME"),this.iframe.setAttribute("src",l),this.iframe.setAttribute("class","culqi-element_iframe"),this.iframe.setAttribute("name","culqi-element_"+a),this.iframe.setAttribute("allowtransparency","true"),this.iframe.setAttribute("frameborder","0"),this.iframe.style.height="inherit",this.iframe.style.width="100%"}var m,x,b;return m=s,(x=[{key:"mount",value:function(a){var r=this;document.querySelector(a).appendChild(r.iframe);var v=document.querySelector(a+" iframe");v.onload=function(){v.contentWindow.postMessage({data:r.options,clqElementType:r.type,type:"clq_setElementData"},l)}}},{key:"on",value:function(a,r){var v=this;window.addEventListener("message",function(i){var y=v.type.toLowerCase();i.data.type=="clq-element_status"&&y==i.data.data.element.replace("-","")&&(a=="all"?r&&r({event:i.data.event,data:i.data.data}):i.data.event==a&&r&&r({data:i.data.data}))},!1)}}])&&n(m.prototype,x),b&&n(m,b),s}();u.default=p,w.exports=u.default}]);var Culqi=new culqijs.Checkout;
  Culqi.publicKey = "sk_live_62fe09ae2c3970d3";
  Culqi.settings({
    title: "MemoFlashcards",
    currency: "PEN",
    description: "Suscripción Mensual",
    amount: 3490,
  });
  Culqi.open();
  Culqi.options({
      style: {
        logo: 'https://www.memoflashcards.com/img/logo.svg',
        maincolor: '#3b2ebf',
        buttontext: '#ffffff',
        maintext: '#4A4A4A',
        desctext: '#4A4A4A'
      }
  });
  function culqi() {
    if (Culqi.token) {
      // ¡Objeto Token creado exitosamente!
      const myToken = Culqi.token;
      window.ReactNativeWebView.postMessage(
        JSON.stringify({ token: myToken, message: "OK" })
      );
    } else {
      // Mostramos JSON de objeto error en consola
      window.ReactNativeWebView.postMessage(
        JSON.stringify({ token: "-1", message: Culqi.error.merchant_message })
      );
    }
  }`; //`

  const _onMessage = event => {
    console.log('_onMessage', JSON.parse(event.nativeEvent.data));
    const res = JSON.parse(event.nativeEvent.data);
  };

  return (
    <View style={styles.container}>
      <WebView
        scalesPageToFit={false}
        injectedJavaScript={jsCode}
        onMessage={_onMessage}
      />
    </View>
  );
};

export default CheckoutScreen;

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
});
